$users = Get-Mailbox -Resultsize Unlimited
Get-MailboxFolderPermission
foreach ($user in $users)

Get-Mailbox -ResultSize Unlimited | ForEach {Get-MailboxFolderPermission -Identity "$($_.PrimarySMTPAddress):\Calendar" } | Where-Object {$_.User.DisplayName -ne "Default" -and $_.User.DisplayName -ne "Anonymous"} | Select Identity,User,AccessRights

$Result=@()
$allMailboxes = Get-Mailbox -ResultSize Unlimited | Select-Object -Property Displayname,PrimarySMTPAddress
$totalMailboxes = $allMailboxes.Count
$i = 1
$allMailboxes | ForEach-Object {
$mailbox = $_
Write-Progress -activity "Processing $($_.Displayname)" -status "$i out of $totalMailboxes completed"
$folderPerms = Get-MailboxFolderPermission -Identity "$($_.PrimarySMTPAddress):\Calendar"
$folderPerms | ForEach-Object {
$Result += New-Object PSObject -property @{
MailboxName = $mailbox.DisplayName
User = $_.User
Permissions = $_.AccessRights
}}
$i++
}
$Result | Select MailboxName, User, Permissions |
Export-CSV "C:\Users\Ian Neil\Documents\Excel" -NoTypeInformation -Encoding UTF8


PS C:\Users\Ian Neil> $Result=@()                                                                                       PS C:\Users\Ian Neil> $allMailboxes = Get-Mailbox -ResultSize Unlimited | Select-Object -Property Displayname,PrimarySMTPAddress                                                                                                                PS C:\Users\Ian Neil> $totalMailboxes = $allMailboxes.Count                                                             PS C:\Users\Ian Neil> $i = 1                                                                                            PS C:\Users\Ian Neil> $allMailboxes | ForEach-Object {                                                                  >> $mailbox = $_                                                                                                        >> Write-Progress -activity "Processing $($_.Displayname)" -status "$i out of $totalMailboxes completed"                >> $folderPerms = Get-MailboxFolderPermission -Identity "$($_.PrimarySMTPAddress):\Calendar"                            >> $folderPerms | ForEach-Object {                                                                                      >> $Result += New-Object PSObject -property @{                                                                          >> MailboxName = $mailbox.DisplayName                                                                                   >> User = $_.User                                                                                                       >> Permissions = $_.AccessRights                                                                                        >> }}                                                                                                                   >> $i++                                                                                                                 >> }                                                                                                                    The operation couldn't be performed because 'andrew.kolos@alianza.com:\Calendar' couldn't be found.                         + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=14bbb3a1-5799-4eb6-8f42-0054b27ef731,TimeStamp=8/22/2022      8:50:53 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] 1D21ACEF,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'andrew.shevchuk@alianza.com:\Calendar' couldn't be found.                      + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=991a6ebf-bc20-405b-a556-71d2bc1b75fe,TimeStamp=8/22/2022      8:50:56 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] FBF669AC,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'anton.nakonechnyi@alianza.com:\Calendar' couldn't be found.                    + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=0bd5ee45-8313-4601-8533-d49ac892c790,TimeStamp=8/22/2022      8:51:06 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] F4E6A095,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'carla.firmino@alianza.com:\Calendar' couldn't be found.                        + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=bb2fcc34-a41a-4a2b-ba9b-e09964c99251,TimeStamp=8/22/2022      8:51:45 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] 6F2DCB77,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'daniel.lima@alianza.com:\Calendar' couldn't be found.                          + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=047cff83-24e3-4d7c-8ce6-b0c3681e27cd,TimeStamp=8/22/2022      8:52:22 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] 620DE2D0,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'jose.pinto@alianza.com:\Calendar' couldn't be found.                           + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=9df46d2a-2973-4480-a7e2-b97d4cfeb02e,TimeStamp=8/22/2022      8:55:17 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] 390B2E17,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             Processing data from remote server outlook.office365.com failed with the following error message: WinRM cannot          complete the operation. Verify that the specified computer name is valid, that the computer is accessible over the      network, and that a firewall exception for the WinRM service is enabled and allows access from this computer. By        default, the WinRM firewall exception for public profiles limits access to remote computers within the same local       subnet. For more information, see the about_Remote_Troubleshooting Help topic.                                              + CategoryInfo          : OperationStopped: (outlook.office365.com:String) [], PSRemotingTransportException             + FullyQualifiedErrorId : JobFailure                                                                                    + PSComputerName        : outlook.office365.com                                                                                                                                                                                             Creating a new Remote PowerShell session using Modern Authentication for implicit remoting of "Get-MailboxFolderPermission" command ...                                                                                                         The operation couldn't be performed because 'luis.palma@alianza.com:\Calendar' couldn't be found.                           + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=fdfae483-2bb2-4463-9870-51b5ea7795e6,TimeStamp=8/22/2022      9:01:26 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] B540773C,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'mariana.arduini@alianza.com:\Calendar' couldn't be found.                      + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=e845b145-2f51-48aa-b9b9-31b2533e0d22,TimeStamp=8/22/2022      9:01:36 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] DDF39357,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'maxim.boykin@alianza.com:\Calendar' couldn't be found.                         + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=925decd0-e7eb-427a-ad27-de218ebef648,TimeStamp=8/22/2022      9:01:52 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] D8B5B51E,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'mykhailo.sych@alianza.com:\Calendar' couldn't be found.                        + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=54aa6b1d-1494-43e8-8b57-7258ba9fa9a0,TimeStamp=8/22/2022      9:02:30 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] 21F54BAB,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'mykyta.lebid@alianza.com:\Calendar' couldn't be found.                         + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=288c19d3-37ae-4d0d-ace1-d67b76530e29,TimeStamp=8/22/2022      9:02:31 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] B1A3B171,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com                                                                                                                                                                                             The operation couldn't be performed because 'oleksandr.kravets@alianza.com:\Calendar' couldn't be found.                    + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException            + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=fe53cea7-392a-4eb7-8f99-101495d88d76,TimeStamp=8/22/2022      9:02:56 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] F7E64E33,Microsoft.Exchange.Management.Sto     reTasks.GetMailboxFolderPermission                                                                                        + PSComputerName        : outlook.office365.com
The operation couldn't be performed because 'oleksandr.svirskyi@alianza.com:\Calendar' couldn't be found.
    + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException
    + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=6f9adb4d-1dfc-4a5b-8c52-a97077acba38,TimeStamp=8/22/2022
    9:02:58 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] B4B581F3,Microsoft.Exchange.Management.Sto
  reTasks.GetMailboxFolderPermission
    + PSComputerName        : outlook.office365.com

The operation couldn't be performed because 'sergii.sibirtsev@alianza.com:\Calendar' couldn't be found.
    + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException
    + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=d205e194-f57e-45f9-8aaf-18afe6dc4e0f,TimeStamp=8/22/2022
    9:05:05 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] 95BC437E,Microsoft.Exchange.Management.Sto
  reTasks.GetMailboxFolderPermission
    + PSComputerName        : outlook.office365.com

The operation couldn't be performed because 'sveselinov@alianza.com:\Calendar' couldn't be found.
    + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException
    + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=64970ce4-d906-47cd-a8ca-20e65abd30fe,TimeStamp=8/22/2022
    9:05:30 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] 8DE077CC,Microsoft.Exchange.Management.Sto
  reTasks.GetMailboxFolderPermission
    + PSComputerName        : outlook.office365.com

The operation couldn't be performed because 'vitaliy.kravchenko@alianza.com:\Calendar' couldn't be found.
    + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException
    + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=371b7c29-6807-4b6b-8178-01eb566491b3,TimeStamp=8/22/2022
    9:06:31 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] 6D1D1DEE,Microsoft.Exchange.Management.Sto
  reTasks.GetMailboxFolderPermission
    + PSComputerName        : outlook.office365.com

The operation couldn't be performed because 'vitor.shinohara@alianza.com:\Calendar' couldn't be found.
    + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException
    + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=b044c852-c99b-4b17-89bf-e6b2e07458ef,TimeStamp=8/22/2022
    9:06:32 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] FFDD530F,Microsoft.Exchange.Management.Sto
  reTasks.GetMailboxFolderPermission
    + PSComputerName        : outlook.office365.com

The operation couldn't be performed because 'vukasin.petrovic@alianza.com:\Calendar' couldn't be found.
    + CategoryInfo          : NotSpecified: (:) [Get-MailboxFolderPermission], ManagementObjectNotFoundException
    + FullyQualifiedErrorId : [Server=BN6PR13MB3043,RequestId=6d60ac05-31cc-4298-9f03-671b577bbc70,TimeStamp=8/22/2022
    9:06:35 PM] [FailureCategory=Cmdlet-ManagementObjectNotFoundException] D50933BD,Microsoft.Exchange.Management.Sto
  reTasks.GetMailboxFolderPermission
    + PSComputerName        : outlook.office365.com

PS C:\Users\Ian Neil> $Result | Select MailboxName, User, Permissions |
>> Export-CSV "C:\Users\Ian Neil\Documents\Excel" -NoTypeInformation -Encoding UTF8
Export-CSV : Access to the path 'C:\Users\Ian Neil\Documents\Excel' is denied.
At line:2 char:1
+ Export-CSV "C:\Users\Ian Neil\Documents\Excel" -NoTypeInformation -En ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OpenError: (:) [Export-Csv], UnauthorizedAccessException
    + FullyQualifiedErrorId : FileOpenFailure,Microsoft.PowerShell.Commands.ExportCsvCommand

PS C:\Users\Ian Neil> $Result | Select MailboxName, User, Permissions |
>> Export-CSV "C:\useful stuff\calenderperms.csv" -NoTypeInformation -Encoding UTF8
PS C:\Users\Ian Neil>
